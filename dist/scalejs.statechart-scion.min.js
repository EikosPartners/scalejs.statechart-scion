define("scalejs.statechart-scion/state.builder",["scalejs!core","scion-ng"],function(a,b){return function(c){function d(a){return A(function(b){if(b.onEntry)throw new Error("Only one `onEntry` action is allowed.");if("function"!=typeof a)throw new Error("`onEntry` takes a function as a parameter.");return b.onEntry=a,b})}function e(a){return A(function(b){if(b.onExit)throw new Error("Only one `onExit` action is allowed.");if("function"!=typeof a)throw new Error("`onExit` takes a function as a parameter.");return b.onExit=a,b})}function f(a){return A(function(b){b.event=a})}function g(a){return A(function(b){b.cond=a})}function h(a,b,c){return A(function(d){return"state"===d.type||"parallel"===d.type?u(h(a,b,c))(d):(a&&(d.type="internal"),void("function"==typeof b?d.onTransition=b:(d.target=x(b,"array")?b:b.split(" "),c&&(d.onTransition=c))))})}function i(a,b){return h(!1,a,b)}function j(a,b){return h(!0,a,b)}function k(a){if("function"==typeof a)return A(function(b){b.onTransition=a});if("$yield"===a.kind)return a;throw new Error("Unsupported transition action",a)}function l(){var a,b=v.copy(arguments),c=b.pop();if(b.length>2)throw new Error("First (optional) argument should be event name, second (optional) argument should be a condition function");if("function"!=typeof c&&"$yield"!==c.kind)throw new Error("Last argument should be either `goto` or a function.");return a=b.map(function(a){if("string"==typeof a)return f(a);if("function"==typeof a)return g(a);throw new Error("Transition argument ",a," is not supported. First (optional) argument should be event name, second (optional) argument should be a condition function")}),A(u.apply(null,a.concat([k(c)])))}function m(){var a=v.copy(arguments),b=a.pop();if(a.forEach(function(a){if("string"!=typeof a)throw new Error("`whenInStates` accepts list of states and either `goto` or a function as the last argument.")}),"function"!=typeof b&&"$yield"!==b.kind)throw new Error("Last argument should be either `goto` or a function.");return A(u(g(function(b,c){return a.every(function(a){return c(a)})}),b))}function n(){var a=v.copy(arguments),b=a.pop();if(a.forEach(function(a){if("string"!=typeof a)throw new Error("`whenNotInStates` accepts list of states and either `goto` or a function as the last argument.")}),"function"!=typeof b&&"$yield"!==b.kind)throw new Error("Last argument should be either `goto` or a function.");return A(u(g(function(b,c){return a.every(function(a){return!c(a)})}),b))}function o(a){return A(function(b){return b.parallel?new Error("`initial` shouldn't be specified on parallel region."):void(b.initial=a)})}function p(c){return function(){var d,e,f;return d=s.apply(null,arguments),e=new b.Statechart(d,y({log:a.log.debug},c)),f=e._scriptingContext.raise,e._scriptingContext.raise=function(a){var b="string"==typeof a?{name:a}:a;f.call(e._scriptingContext,b)},e.send=function(a,b){return e._scriptingContext.send.call(e,a,b||{})},e}}var q,r,s,t,u,v=a.array,w=a.object.has,x=a.type.is,y=a.object.merge,z=a.functional.builder,A=z.$yield;return q=z({run:function(a,b){var c={};return c.type=w(b,"parallel")?"parallel":"state",a(c),c},delay:function(a){return a()},zero:function(){return function(){}},$yield:function(a){return a},combine:function(a,b){return function(c){a(c),b(c)}},missing:function(a){if("string"==typeof a)return function(b){if(b.id)throw new Error("Can't set state id to \""+a+'". state\'s id is already set to "'+b.id+'"');b.id=a};if("function"==typeof a)return a;if("state"===a.type||"parallel"===a.type)return function(b){b.states||(b.states=[]),b.states.push(a)};throw new Error("Missing builder for expression: "+JSON.stringify(a))}}),s=q(),t=q({parallel:!0}),r=z({run:function(a){return function(b){b.transitions||(b.transitions=[]);var c={};a(c),b.transitions.push(c)}},delay:function(a){return a()},zero:function(){return function(){}},$yield:function(a){return a},combine:function(a,b){return function(c){a(c),b(c)}},missing:function(a){if("function"==typeof a)return a;throw new Error('Unknown operation "'+a.kind+'" in transition expression',a)}}),u=r(),{builder:p,state:s,parallel:t,initial:o,onEntry:d,onExit:e,on:l,whenInStates:m,whenNotInStates:n,"goto":i,gotoInternally:j,statechart:p({logStatesEnteredAndExited:c.logStatesEnteredAndExited,log:a.log.debug})}}}),define("scalejs.statechart-scion/state",["scalejs!core","./state.builder","scion-ng","scalejs.functional","scalejs.linq-linqjs"],function(a,b,c){return function(d){function e(a){return t(a,"states")?q.make(a).concat(q.from(a.states).selectMany(e)):q.make(a)}function f(a,b){var c=e(a).firstOrDefault(function(a){return a.id===b});return c}function g(a,b){var c=e(a).firstOrDefault(function(a){return a.states&&a.states.some(function(a){return a.id===b})});return c}function h(){return v(function(a,b){var c,d;if(c=f(o,a),!c)throw new Error('Parent state "'+a+"\" doesn't exist");if(t(b,"id")&&(d=f(o,b.id)))throw new Error('State "'+b.id+'" already exists.');t(c,"states")||(c.states=[]),c.states.push(b)}).apply(null,arguments)}function i(b){if(a.isApplicationRunning())throw new Error("Can't register a state while application is running.");r(arguments,1).forEach(h(b))}function j(a,b){var c;if(c=f(o,a),!c)throw new Error('Parent state "'+a+"\" doesn't exist");b.expr(c)}function k(){if(a.isApplicationRunning())throw new Error("Can't unregister a state while application is running.");r(arguments).forEach(function(a){var b=g(o,a),c=q.from(b.states).first(function(b){return b.id===a});s(b.states,c)})}function l(a,b,c){var d;if(u(a,"string"))d={name:a};else{if(!t(a,"name"))throw new Error("event object should have `name` property.");d=a}!t(c)&&u(b,"number")?c=b:d.data=b,p.send(d,{delay:c})}function m(){return a.reactive.Observable.create(function(a){var b={onEntry:function(b,c){a.onNext({event:"entry",state:b,context:this,currentEvent:c})},onExit:function(b,c){a.onNext({event:"exit",state:b,currentEvent:c})},onTransition:function(b,c,d){a.onNext({event:"transition",source:b,targets:c,currentEvent:d})}};return p?p.registerListener(b):z.push(b),function(){p.unregisterListener(b)}})}function n(a){return function(b){m().where(function(b){return"entry"===b.event&&b.state===a}).take(1).subscribe(function(){b()})}}var o,p,q=a.linq.enumerable,r=a.array.toArray,s=a.array.removeOne,t=a.object.has,u=a.type.is,v=a.functional.curry,w=b(d),x=w.state,y=w.parallel,z=[];return o=x("scalejs-app",y("root")),a.onApplicationEvent(function(b){var e;switch(b){case"started":p=new c.Statechart(o,{logStatesEnteredAndExited:d.logStatesEnteredAndExited,log:a.log.debug}),e=p._scriptingContext.raise,p._scriptingContext.raise=function(a){var b="string"==typeof a?{name:a}:a;e.call(p._scriptingContext,b)},p.send=function(a,b){return p._scriptingContext.send.call(p,a,b||{})},z.forEach(function(a){p.registerListener(a)}),p.start();break;case"stopped":}}),{registerStates:i,registerTransition:j,unregisterStates:k,raise:l,observe:m,onState:n,builder:w}}}),define("scalejs.statechart-scion",["scalejs!core","./scalejs.statechart-scion/state","module"],function(a,b,c){a.registerExtension({state:b(c.config())})});